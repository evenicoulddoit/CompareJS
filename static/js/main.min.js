'use strict';(function(){window.specificity=function(m){var n=m,w={a:0,b:0,c:0},p=[];m=function(z,m){var q,a,e,l,r,h;if(z.test(n))for(q=n.match(z),a=0,e=q.length;a<e;a+=1)w[m]+=1,l=q[a],r=n.indexOf(l),h=l.length,p.push({selector:l,type:m,index:r,length:h}),n=n.replace(l,Array(h+1).join(" "))};(function(){var m=/:not\(([^\)]*)\)/g;m.test(n)&&(n=n.replace(m,"     $1 "))})();(function(){var m=/{[^]*/gm,p,q,a;if(m.test(n))for(m=n.match(m),p=0,q=m.length;p<q;p+=1)a=m[p],n=n.replace(a,Array(a.length+1).join(" "))})();
m(/(\[[^\]]+\])/g,"b");m(/(#[^\s\+>~\.\[:]+)/g,"a");m(/(\.[^\s\+>~\.\[:]+)/g,"b");m(/(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi,"c");m(/(:[\w-]+\([^\)]*\))/gi,"b");m(/(:[^\s\+>~\.\[:]+)/g,"b");n=n.replace(/[\*\s\+>~]/g," ");n=n.replace(/[#\.]/g," ");m(/([^\s\+>~\.\[:]+)/g,"c");p.sort(function(m,p){return m.index-p.index});return parseInt([w.a,w.b,w.c].join(""),10)}})(window);(function(m,n,w){function p(d){return function(b){return 0===b.indexOf(d)}}function z(d){var b={},k=d.ownerDocument.styleSheets,g,f,c,A,a,e,l,m,h;for(l=0;l<k.length;l++)if(g=k[l],g=g.cssRules)for(m=0;m<g.length;m++)if(f=g[m],1===f.type){c=f.selectorText.split(I).filter(D);a=c.length;e=[];for(h=0;h<a;h++){A=c[h];try{var p;a:{for(var s=d,r=A,t=void 0,B=void 0,q=["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector"],t=0;t<q.length;t++)if(B=q[t],B in s){p=s[B](r);break a}p=void 0}if(p){e.push(n(A));
break}}catch(v){if(!(v instanceof SyntaxError))throw v;}}if(e.length)for(c=Math.max.apply(Math,e),A=b,f=f.style,a=f.length,h=s=e=void 0,h=0;h<a;h++)s=e=f[h],r=s.indexOf("-value"),-1!==r&&r===s.length-6&&(s=s.substring(0,r)),s in A&&c<A[s].specificity||(A[s]={specificity:c,value:f.getPropertyValue(e)})}return b}function D(d){return""!==d.trim()}function q(d,b){var k=b.length,g,f;for(f=0;f<k;f++)if(0===f)g=d[b[f]];else if(d[b[f]]!==g)return!1;return!0}function a(d,b){var k=b.length,g;for(g=0;g<k;g++)delete d[b[g]]}
function e(d){var b,k,g;["a","b"].forEach(function(f){["margin","padding"].forEach(function(c){b=d[f];k=!1;g=Object.keys(b).filter(function(d){return 0===d.indexOf(c+"-")});4==g.length&&(q(b,g)?(k=!0,b[c]=b[g[0]]):q(b,[c+"-left",c+"-right"])&&(k=!0,q(b,[c+"-top",c+"-bottom"])?b[c]=b[c+"-top"]+" "+b[c+"-left"]:b[c]=b[c+"-top"]+" "+b[c+"-left"]+" "+b[c+"-bottom"]),k&&a(b,[c+"-top",c+"-right",c+"-bottom",c+"-left"]))})})}function l(d){var b;if(!d.last)return d.last=d.stop,l(d);b=r(d);return null!==b&&
d.exclude&&h(b,d.exclude)?(d.no_down=!0,d.last=b,l(d)):b}function r(d){var b=d.last,k;if(!d.no_down&&(k=(k=d.all)&&b.childNodes.length?b.childNodes[0]:!k&&b.children.length?b.children[0]:null,k))return k;d.no_down=!1;if(k=d.all?b.nextSibling:b.nextElementSibling)return k;for(;b!=d.stop;){b=b.parentNode;if(b==d.stop)return null;if(k=d.all?b.nextSibling:b.nextElementSibling)return k}}function h(d,b){var k=b.length,g,f,c;f=0;a:for(;f<k;f++)if(g=b[f],!g.hasOwnProperty("tag")||g.tag===d.tagName){if(g.hasOwnProperty("attributes"))for(c in g.attributes)if(g.attributes[c]!==
d.getAttribute(c))continue a;return g}return!1}function B(d){return{1:"element",3:"text"}[d.nodeType.toString()]}function y(d){var b=d.tagName.toLowerCase(),k;k=d.attributes.length;var g=[],f="",c,a;for(a=0;a<k;a++)g.push(d.attributes[a].name);g.sort();for(a=0;a<k;a++)c=g[a],f+=" "+c+'="'+d.attributes.getNamedItem(c).value+'"';k=f;g=d.childNodes.length;f=[];for(a=0;a<g;a++)c=d.childNodes[a],"text"==B(c)&&f.push(c.nodeValue);g=f.join(" ").replace(C," ").trim();f="<"+b+k+">";d._sig=d._originalSig=f+
g+"</"+b+">";d._tagSig=f;d._attrStr=k;d._textStr=g;return d._sig}function v(d,b){var k=b.exec(d),g,a;if(null===k)return d;k.shift();g=k.length;for(a=0;a<g;a++)d=d.replace(k[a],"");return d}function u(d){this.name="ReachedLimitError";this.message=d;this.stack=Error().stack}function E(){this.a=[];this.b=[]}function F(d){if(!d.a||!d.b)throw new TypeError("You must supply both DOM tree A and B");this.opts=d;this.a=d.a;this.b=d.b;this.MAX_DIFFERENCES=d.max_differences||25;this.aStyleSheets=this.a.ownerDocument.styleSheets;
this.bStyleSheets=this.b.ownerDocument.styleSheets;this.differenceCount=0;this.differences={tag:[],attr:[],removed:[],added:[],text:[],moved:[],space:[],style:[]};this.parse_exclusions();this.signatureMap={};try{this._parse_elements(),this._process_imbalances(),this._find_movements()}catch(b){if(!(b instanceof u))throw b;}}var G=/^\s+/,H=/\s+$/,C=/\s{2,}/g,I=/,(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/g;u.prototype=Object.create(Error.prototype);E.prototype.push=function(d,b){this[d].push(b)};F.prototype=
{parse_exclusions:function(){var d,b,k,a,f;this.exclude_completely=[];this.exclude_changes=[];if(this.opts.exclude instanceof Array)for(d=this.opts.exclude.length,b=0;b<d;b++)if(k=this.opts.exclude[b],"string"===typeof k.tag||k.attributes instanceof Array)if("string"===typeof k.tag&&(k.tag=k.tag.toUpperCase()),k.hasOwnProperty("method")&&"all"!==k.method){a=k.method.attr;if("object"==typeof a)for(f in a)if("*"!==a[f])try{a[f]=new RegExp(a[f],"i")}catch(c){throw new SyntaxError("Failed to parse exception RegExp: "+
a[f]);}this.exclude_changes.push(k)}else this.exclude_completely.push(k)},_parse_elements:function(){var d,b,k;["a","b"].forEach(function(a){k=0;d=this["elems"+a.toUpperCase()]=[];for(b=l({stop:this[a],exclude:this.exclude_completely});b;)y(b),this.add_to_map(b,a),d.push(b),b._index=k,b=l({last:b,stop:this[a],exclude:this.exclude_completely}),k++;this["total"+a.toUpperCase()]=k},this)},_find_movements:function(){for(var d={},b={},a=0,g=0,f,c,e,l;;){f=this.elemsA[a];c=this.elemsB[g];if(!f&&!c)break;
e=f?f._sig:"";l=c?c._sig:"";e==l?(a++,g++):e in d||l in b?(e in d&&(this._difference("moved",f,d[e]),delete d[e],a++),l in b&&(this._difference("moved",b[l],c),delete b[l],g++)):(d[l]=c,b[e]=f,a++,g++)}},add_to_map:function(d,b){var a=y(d);a in this.signatureMap||(this.signatureMap[a]=new E);this.signatureMap[a].push(b,d)},_process_imbalances:function(){var d=[],b=[],a,g,f;for(a in this.signatureMap)g=this.signatureMap[a],g.a.length!=g.b.length&&(g.a.length&&Array.prototype.push.apply(d,g.a),g.b.length&&
Array.prototype.push.apply(b,g.b));for(g=0;g<d.length;g++)a=d[g],(f=this._find_match(a,b))?(-1!==["attr","tag","text"].indexOf(f.type)&&this.should_report_change(a,f)&&this._difference(f.type,a,f.elem),f.elem._sig=a._sig,b.splice(b.indexOf(f.elem),1)):this._difference("removed",a);for(g=0;g<b.length;g++)this._difference("added",b[g])},_find_match:function(d,b){var a=[],g=!1,f,c,e,l,h;for(c=0;c<b.length;c++)f=b[c],e=d.tagName===f.tagName,l=d._attrStr===f._attrStr,h=d._textStr===f._textStr,2<=e+l+h&&
(f={elem:f},e&&l&&h?(f.type="identical",g=!0):(e||(f.type="tag"),l||(f.type="attr"),h||(f.type="text")),a.push(f));g&&(a=a.filter(function(d){return"identical"==d.type}));return 0<a.length?a.sort(function(a,b){var c=Math.abs(a.elem._index-d._index),f=Math.abs(b.elem._index-d._index);return c<f?-1:f<c?1:0})[0]:null},should_report_change:function(d,a){var k=h(d,this.exclude_changes);if(!k||!k.method.hasOwnProperty(a.type))return!0;if("attr"==a.type)return!this.attr_changes_match(d,a.elem,k.method.attr)},
attr_changes_match:function(a,b,k){var g=[],f=a.attributes.length,c,e,l,h;for(e=0;e<f;e++)if(c=a.attributes[e].name,l=a.getAttribute(c),h=b.getAttribute(c),g.push(c),l!==h&&(c=k[c],void 0===c||c instanceof RegExp&&v(l,c)!==v(h,c)))return!1;f=b.attributes.length;for(e=0;e<f;e++)if(c=b.attributes[e].name,-1==g.indexOf(c)&&-1==k.indexOf(c))return!1;return!0},find_visual_differences:function(a,b){var k=0,g=0,f=0,c,h,r,n,q;void 0===a&&(a=l({stop:this.a,all:!0,exclude:this.exclude_completely}),b=l({stop:this.b,
all:!0,exclude:this.exclude_completely}));for(;null!==a&&null!==b&&25>k;){c=a&&B(a);h=b&&B(b);r=[c,h].sort();n=q=!0;"element"==c&&(g=a._index);"element"==h&&(f=b._index);if(c!==h)if("element"==r[0]&&"text"==r[1])"element"==c?n=!1:q=!1;else{if(-1!=r.indexOf("element")||-1!=r.indexOf("text"))"element"==c||"text"==c?n=!1:q=!1}else if("element"==c){c=a;h=b;var v=c,x=h;r=m.getComputedStyle(v);for(var u=m.getComputedStyle(x),v=v.ownerDocument.URL.split("/").slice(0,3).join("/"),x=x.ownerDocument.URL.split("/").slice(0,
3).join("/"),s=[],w=r.length,t=void 0,y=void 0,y=0;y<w;y++)t=r[y],r.getPropertyValue(t).replace(v,"")!=u.getPropertyValue(t).replace(x,"")&&s.push(t);r=s;u={a:{},b:{}};v=0;x=s=void 0;if(r.length){c=z(c);h=z(h);s={};w=[];y=t=void 0;for(t in c)y=(h[t]||{}).value,c[t].value!=y&&(s[t]=[c[t].value,y]),w.push(t);for(t in h)-1==w.indexOf(t)&&(s[t]=[void 0,h[t].value]);for(x in s)0<r.filter(p(x)).length&&(void 0!==s[x][0]&&(u.a[x]=s[x][0]),void 0!==s[x][1]&&(u.b[x]=s[x][1]),v++)}e(u);c=0!==v?u:null;null!==
c&&(h=this.already_reported_style_change(a,c),null===h?(a._styleAffects=1,a._styleDiff=c,this._difference("style",a,b)):h._styleAffects++)}else{if(c="text"==c&&a.nodeValue!==b.nodeValue)c=b,c=a.nodeValue.replace(C,"")===c.nodeValue.replace(C,"");c&&(c=a,h=b,parentStyle=m.getComputedStyle((c||h).parentNode),parentBlock="block"===parentStyle.getPropertyValue("display"),parentFloat="none"!==parentStyle.getPropertyValue("float"),parentSpaceMatters=parentBlock||parentFloat,textA=null!==c?c.nodeValue:"",
textB=null!==h?h.nodeValue:"",back,forward,c=!1);c&&this._difference("space",a,b)}n&&(a=l({last:a,stop:this.a,all:!0,exclude:this.exclude_completely}));q&&(b=l({last:b,stop:this.b,all:!0,exclude:this.exclude_completely}));k++}a||b?(k=Math.round(50*(g/this.totalA+f/this.totalB)),k=Math.min(99,k)):k=100;return{a:a,b:b,progress:k}},already_reported_style_change:function(a,b){var e=this.differences.style,g=e.length,f,c;for(f=0;f<g;f++)if(c=e[f][0],a._tagSig===c._tagSig&&JSON.stringify(b)===JSON.stringify(c._styleDiff))return c;
return null},_different_spaces:function(a,b){var e=null===a.match(G),g=null===b.match(G),f=null===a.match(H),c=null===b.match(H),h=[];e!=g&&h.push("left");f!=c&&h.push("right");return h},_difference:function(a,b,e){this.differenceCount++;this.differences[a].push([b,e]);if(this.differenceCount>=this.MAX_DIFFERENCES)throw this.stopped_at_max=!0,new u("Max number of differences reached");}};m.Compare=F})(window,window.specificity,window.console.log.bind(window.console));(function(m,n,w){function p(a){return String(a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function z(a){var e=1!=a.indexOf("?")?"?":"&";return a+e+"_cachebust="+Date.now()}try{document.domain="compare.js"}catch(D){w("FAILed to set document.domain to compare.js - make sure that you've your ServerName is correctly set to compare.js")}var q={init:function(){this.responseActive=!1;this.frameA=this.make_iframe();this.frameB=this.make_iframe();this.parse_dom();
this.settings={};this.events()},parse_dom:function(){this.wrapper=document.getElementById("wrapper");this.inA=document.getElementById("page-a");this.inB=document.getElementById("page-b");this.startOverBtn=document.getElementById("do-start-over");this.inBtn=document.getElementById("do-compare");this.settingsDom={toggle:document.getElementById("settings-toggle"),cacheBust:document.getElementById("settings-cache-bust"),exclude:document.getElementById("settings-exclude")};this.response=document.getElementById("response");
this.responseIcon=document.getElementById("response-icon");this.responseSummary=document.getElementById("response-summary");this.responseDetails=document.getElementById("response-details")},process_settings:function(){var a=this.settingsDom.exclude.value.trim();this.settings.cacheBust="yes"===this.settingsDom.cacheBust.value;if(a)try{this.settings.exclude=JSON.parse(a)}catch(e){if(e instanceof SyntaxError)throw this.compare_failed("Failed to parse exclusions JSON block"),e;}else this.settings.exclude=
[]},process_start_over:function(){this.process_comparison(!0)},process_comparison:function(a){var e;""!==this.inA.value&&""!==this.inB.value&&(this.process_settings(),this.toggle_settings(!1),this.inBtn.className="",this.wrapper.setAttribute("class","loading"),this.remove_response(),!0===a?(this.report_progress("Loading pages"),a=this.get_contents(this.frameA,this.inA.value),e=this.get_contents(this.frameB,this.inB.value),m.all([a,e]).then(this.do_compare.bind(this,!0),this.compare_failed.bind(this)).catch(this.compare_failed.bind(this))):
this.do_compare(!1,[this.frameA.contentDocument.body,this.frameB.contentDocument.body]))},response_active:function(){this.responseActive=!0;this.wrapper.setAttribute("class","with-response")},response_inactive:function(){this.responseActive=!1;this.wrapper.removeAttribute("class")},do_compare:function(a,e){var l=this,m=a?2E3:1E3,h;this.report_progress("Calculating DOM differences");setTimeout(function(){try{h=new n({a:e[0],b:e[1],exclude:l.settings.exclude}),l.compare=h}catch(a){return l.compare_failed(a)}if(h.stopped_at_max)return l.response_active(),
l.differences_true(h.differences);l._async_visual()},m)},_async_visual:function(a){var e=this,l,m;void 0===a&&(a={progress:0});if(100>a.progress)setTimeout(function(){try{a=e.compare.find_visual_differences(a.a,a.b),e.report_progress("Calculating visual differences &mdash; "+a.progress+"% complete"),e._async_visual(a)}catch(h){return e.compare_failed(h)}},0);else{l=e.compare.differences;e.response_active();for(m in l)if(0!==l[m].length)return e.differences_true(l);return e.differences_false()}},remove_response:function(){this.response.removeAttribute("class");
this.responseIcon.removeAttribute("class");this.responseSummary.innerHTML="";this.responseDetails.innerHTML=""},differences_true:function(a){var e=0,l=document.createElement("ul"),m,h,p,n,q;for(m in a)for(h=a[m],n=h.length,e+=h.length,q=0;q<n;q++)p=document.createElement("li"),p.innerHTML=this.report_difference(m,h[q]),l.appendChild(p);this.compare.stopped_at_max&&(e+="+");this.response.setAttribute("class","errors");this.responseIcon.setAttribute("class","issues fa fa-exclamation-circle");this.responseSummary.innerHTML=
e+" Difference(s) Found";this.responseDetails.appendChild(l)},differences_false:function(){this.response.setAttribute("class","identical");this.responseIcon.setAttribute("class","fa fa-check-circle");this.responseSummary.innerHTML="Pages are identical";this.responseDetails.innerHTML="We've checked the pages for both DOM and visual differences, and we couldn't find any!"},report_progress:function(a){this.response.setAttribute("class","loading");this.responseIcon.setAttribute("class","fa fa-spin fa-spinner");
this.responseSummary.innerHTML=a;this.responseDetails.innerHTML=""},report_difference:function(a,e){switch(a){case "tag":return'Tag change<code class="a">'+p(e[0]._originalSig)+'</code><code class="b">'+p(e[1]._originalSig)+"</code>";case "attr":return'Attribute change<code class="a">'+p(e[0]._originalSig)+'</code><code class="b">'+p(e[1]._originalSig)+"</code>";case "removed":return'Element removed<code class="a removed">'+p(e[0]._originalSig)+"</code>";case "added":return'Element added<code class="b">'+
p(e[0]._originalSig)+"</code>";case "text":return'Text changed<code class="a">'+p(e[0]._originalSig)+'</code><code class="b">'+p(e[1]._originalSig)+"</code>";case "moved":return'Element Moved<code class="a">'+p(e[0]._originalSig)+"</code>";case "style":var l=e[0]._styleDiff,m=e[0]._styleAffects,h="",n="",q=Object.keys(l.a).length,v=Object.keys(l.b).length,u;for(u in l.a)1<q&&(h+="\n  "),h+=u+": "+l.a[u]+"; ";for(u in l.b)1<v&&(n+="\n  "),n+=u+": "+l.b[u]+"; ";1<q&&(h+="\n");1<v&&(n+="\n");return"Style change affecting "+
m+' element(s)<code class="c">'+p(e[0]._originalSig)+'</code><code class="a">{ '+h+'}</code><code class="b">{ '+n+"}</code>"}},compare_failed:function(a){this.wrapper.setAttribute("class","with-response");this.remove_response();this.response_active();if("object"===typeof a&&"ReachedLimitError"===a.name)return this.differences_true(this.compare.differences);w("Error: ",a);this.response.setAttribute("class","errors");this.responseIcon.setAttribute("class","issues fa fa-exclamation-circle");this.responseSummary.innerHTML=
"Comparison failed";this.responseDetails.innerHTML="string"===typeof a?a:void 0!==a.error&&"SecurityError"===a.error.name?"Failed to access <em>"+a.url+"</em> due to cross-origin restrictions":"An unknown error was raised"},make_iframe:function(){var a=document.createElement("iframe");document.getElementById("iframes").appendChild(a);return a},get_contents:function(a,e){a.src=this.settings.cacheBust?z(e):e;a.removeEventListener("load",a._loadEvent);return new m(function(l,m){a._loadEvent=function(){try{l(a.contentDocument.body)}catch(h){m({error:h,
url:e})}};a.addEventListener("load",a._loadEvent)})},process_if_enter:function(a){13==a.keyCode&&this.process_comparison(!0)},toggle_settings:function(a){this.settingsDom.toggle.className=!0===a||!1!==a&&""===this.settingsDom.toggle.className?this.settingsDom.toggle.className+"open":""},events:function(){this.inBtn.addEventListener("click",this.process_comparison.bind(this));this.startOverBtn.addEventListener("click",this.process_start_over.bind(this));this.inA.addEventListener("keypress",this.process_if_enter.bind(this));
this.inB.addEventListener("keypress",this.process_if_enter.bind(this));this.settingsDom.toggle.addEventListener("click",this.toggle_settings.bind(this))}};document.addEventListener("DOMContentLoaded",q.init.bind(q))})(window.Promise,window.Compare,window.console.log.bind(window.console));
