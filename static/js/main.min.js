'use strict';(function(){window.specificity=function(g){var k=g,r={a:0,b:0,c:0},l=[];g=function(v,g){var b,f,q,t,p,n;if(v.test(k))for(b=k.match(v),f=0,q=b.length;f<q;f+=1)r[g]+=1,t=b[f],p=k.indexOf(t),n=t.length,l.push({selector:t,type:g,index:p,length:n}),k=k.replace(t,Array(n+1).join(" "))};(function(){var g=/:not\(([^\)]*)\)/g;g.test(k)&&(k=k.replace(g,"     $1 "))})();(function(){var g=/{[^]*/gm,l,b,f;if(g.test(k))for(g=k.match(g),l=0,b=g.length;l<b;l+=1)f=g[l],k=k.replace(f,Array(f.length+1).join(" "))})();
g(/(\[[^\]]+\])/g,"b");g(/(#[^\s\+>~\.\[:]+)/g,"a");g(/(\.[^\s\+>~\.\[:]+)/g,"b");g(/(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi,"c");g(/(:[\w-]+\([^\)]*\))/gi,"b");g(/(:[^\s\+>~\.\[:]+)/g,"b");k=k.replace(/[\*\s\+>~]/g," ");k=k.replace(/[#\.]/g," ");g(/([^\s\+>~\.\[:]+)/g,"c");l.sort(function(g,l){return g.index-l.index});return parseInt([r.a,r.b,r.c].join(""),10)}})(window);(function(g,k,r){function l(a){return function(e){return 0===e.indexOf(a)}}function v(a){var e={},c=a.ownerDocument.styleSheets,d,h,m,b,w,f,g,q;for(f=0;f<c.length;f++)if(d=c[f],d=d.cssRules)for(g=0;g<d.length;g++){h=d[g];m=h.selectorText.split(",");w=[];for(q=0;q<m.length;q++){b=m[f];var l;a:{l=a;for(var p=b,n=void 0,t=void 0,r=["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector"],n=0;n<r.length;n++)if(t=r[n],t in l){l=l[t](p);break a}l=void 0}l&&w.push(k(b))}if(w.length)for(m=
Math.max.apply(Math,w),b=e,h=h.style,w=h.length,l=p=q=void 0,l=0;l<w;l++)p=q=h[l],n=p.indexOf("-value"),-1!==n&&n===p.length-6&&(p=p.substring(0,n)),p in b&&m<b[p].specificity||(b[p]={specificity:m,value:h.getPropertyValue(q)})}return e}function x(a,e){var c=e.length,d,h;for(h=0;h<c;h++)if(0===h)d=a[e[h]];else if(a[e[h]]!==d)return!1;return!0}function b(a,e){var c=e.length,d;for(d=0;d<c;d++)delete a[e[d]]}function f(a){var e,c,d;["a","b"].forEach(function(h){["margin","padding"].forEach(function(m){e=
a[h];c=!1;d=Object.keys(e).filter(function(a){return 0===a.indexOf(m+"-")});4==d.length&&(x(e,d)?(c=!0,e[m]=e[d[0]]):x(e,[m+"-left",m+"-right"])&&(c=!0,x(e,[m+"-top",m+"-bottom"])?e[m]=e[m+"-top"]+" "+e[m+"-left"]:e[m]=e[m+"-top"]+" "+e[m+"-left"]+" "+e[m+"-bottom"]),c&&b(e,[m+"-top",m+"-right",m+"-bottom",m+"-left"]))})})}function q(a,e,c){var d;if(!a)return q(e,e,c);d=c&&a.childNodes.length?a.childNodes[0]:!c&&a.children.length?a.children[0]:null;if(d||(d=c?a.nextSibling:a.nextElementSibling))return d;
for(;a!=e;){a=a.parentNode;if(a==e)return null;if(d=c?a.nextSibling:a.nextElementSibling)return d}}function t(a){return{1:"element",3:"text"}[a.nodeType.toString()]}function p(a){this.name="ReachedLimitError";this.message=a;this.stack=Error().stack}function n(){this.a=[];this.b=[]}function z(a){if(!a.a||!a.b)throw new TypeError("You must supply both DOM tree A and B");this.a=a.a;this.b=a.b;this.MAX_DIFFERENCES=a.max_differences||25;this.aStyleSheets=this.a.ownerDocument.styleSheets;this.bStyleSheets=
this.b.ownerDocument.styleSheets;this.differenceCount=0;this.differences={retag:[],reattribute:[],removed:[],added:[],text:[],moved:[],space:[],style:[]};this.signatureMap={};this._parse_elements();try{this._process_imbalances(),this._find_movements(),0===this.differences.removed.length&&0===this.differences.added.length&&0===this.differences.moved.length&&this.find_visual_differences()}catch(e){if(!(e instanceof p))throw e;}}var s=/^\s+/,u=/\s+$/,y=/\s{2,}/g;r=function(){};p.prototype=Object.create(Error.prototype);
n.prototype.push=function(a,e){this[a].push(e)};z.prototype={_parse_elements:function(){var a=q(this.a,this.a),e=q(this.b,this.b),c=0,d=0;for(this.elemsA=[];a;)this.add_to_map(a,"a"),a._index=c,this.elemsA.push(a),a=q(a,this.a),c++;for(this.elemsB=[];e;)this.add_to_map(e,"b"),e._index=d,this.elemsB.push(e),e=q(e,this.b),d++},_find_movements:function(){for(var a={},e={},c=0,d=0,h,m,b,f;;){h=this.elemsA[c];m=this.elemsB[d];r(h,m);if(!h&&!m)break;b=h?h._sig:"";f=m?m._sig:"";b==f?(r("    Identical"),
c++,d++):b in a||f in e?(b in a&&(this._difference("moved",h,a[b]),delete a[b],c++),f in e&&(this._difference("moved",e[f],m),delete e[f],d++)):(a[f]=m,e[b]=h,c++,d++)}},add_to_map:function(a,e){var c;c=a.tagName.toLowerCase();var d;d=a.attributes.length;var h=[],b="",f,g;for(g=0;g<d;g++)h.push(a.attributes[g].name);h.sort();for(g=0;g<d;g++)f=h[g],b+=" "+f+'="'+a.attributes.getNamedItem(f).value+'"';d=b;h=a.childNodes.length;b=[];for(g=0;g<h;g++)f=a.childNodes[g],"text"==t(f)&&b.push(f.nodeValue);
h=b.join(" ").replace(y," ").trim();a._sig=a._originalSig="<"+c+d+">"+h+"</"+c+">";a._attrStr=d;a._textStr=h;c=a._sig;c in this.signatureMap||(this.signatureMap[c]=new n);this.signatureMap[c].push(e,a)},_process_imbalances:function(){var a=[],e=[],c,d,h;for(c in this.signatureMap)d=this.signatureMap[c],d.a.length!=d.b.length&&(d.a.length&&Array.prototype.push.apply(a,d.a),d.b.length&&Array.prototype.push.apply(e,d.b));for(d=0;d<a.length;d++)c=a[d],(h=this._find_match(c,e))?("attr"===h.type?this._difference("reattribute",
c,h.elem):"tag"===h.type?this._difference("retag",c,h.elem):"text"===h.type&&this._difference("text",c,h.elem),h.elem._sig=c._sig,e.splice(e.indexOf(h.elem),1)):this._difference("removed",c);for(d=0;d<e.length;d++)this._difference("added",e[d])},_find_match:function(a,e){var c=[],d=!1,h,b,f,g,q;for(b=0;b<e.length;b++)h=e[b],f=a.tagName===h.tagName,g=a._attrStr===h._attrStr,q=a._textStr===h._textStr,2<=f+g+q&&(h={elem:h},f&&g&&q?(h.type="identical",d=!0):(f||(h.type="tag"),g||(h.type="attr"),q||(h.type=
"text")),c.push(h));d&&(c=c.filter(function(a){return"identical"==a.type}));return 0<c.length?c.sort(function(e,c){var d=Math.abs(e.elem._index-a._index),b=Math.abs(c.elem._index-a._index);return d<b?-1:b<d?1:0})[0]:null},find_visual_differences:function(){for(var a=q(this.a,this.a,!0),e=q(this.b,this.b,!0),c,d,b;null!==a&&null!==e;)if(c=a&&t(a),d=e&&t(e),b=[c,d].sort(),c!==d)"element"==b[0]&&"text"==b[1]?"element"==c?e=q(e,this.b,!0):a=q(a,this.a,!0):-1!=b.indexOf("element")||-1!=b.indexOf("text")?
"element"==c||"text"==c?e=q(e,this.b,!0):a=q(a,this.a,!0):(a=q(a,this.a,!0),e=q(e,this.b,!0));else{if("element"==c){c=a;var m=d=e;b=g.getComputedStyle(c);for(var m=g.getComputedStyle(m),p=[],n=b.length,k=void 0,r=void 0,r=0;r<n;r++)k=b[r],b.getPropertyValue(k)!=m.getPropertyValue(k)&&p.push(k);b=p;m={a:{},b:{}};p=0;n=k=void 0;if(b.length){c=v(c);d=v(d);var k={},r=[],s=void 0,u=void 0;for(s in c)u=(d[s]||{}).value,c[s].value!=u&&(k[s]=[c[s].value,u]),r.push(s);for(s in d)-1==r.indexOf(s)&&(k[s]=[void 0,
d[s].value]);for(n in k)0<b.filter(l(n)).length&&(void 0!==k[n][0]&&(m.a[n]=k[n][0]),void 0!==k[n][1]&&(m.b[n]=k[n][1]),p++)}f(m);c=0!==p?m:null;null!==c&&(d=this.already_reported_style_change(a,c),null===d?(a._styleAffects=1,a._styleDiff=c,this._difference("style",a,e)):d._styleAffects++)}else{if(c="text"==c&&a.nodeValue!==e.nodeValue)c=e,c=a.nodeValue.replace(y,"")===c.nodeValue.replace(y,"");c&&(c=a,d=e,parentStyle=g.getComputedStyle((c||d).parentNode),parentBlock="block"===parentStyle.getPropertyValue("display"),
parentFloat="none"!==parentStyle.getPropertyValue("float"),parentSpaceMatters=parentBlock||parentFloat,textA=null!==c?c.nodeValue:"",textB=null!==d?d.nodeValue:"",back,forward,c=!1);c&&this._difference("space",a,e)}a=q(a,this.a,!0);e=q(e,this.b,!0)}},already_reported_style_change:function(a,b){var c=this.differences.style,d=c.length,f,g;for(f=0;f<d;f++)if(g=c[f][0],a._sig===g._sig&&JSON.stringify(b)===JSON.stringify(g._styleDiff))return g;return null},_different_spaces:function(a,b){var c=null===
a.match(s),d=null===b.match(s),f=null===a.match(u),g=null===b.match(u),q=[];c!=d&&q.push("left");f!=g&&q.push("right");return q},_difference:function(a,b,c){this.differenceCount++;this.differences[a].push([b,c]);if(this.differenceCount>=this.MAX_DIFFERENCES)throw this.stopped_at_max=!0,new p("Max number of differences reached");}};g.Compare=z})(window,window.specificity,window.console.log.bind(window.console));(function(g,k,r){function l(b){return String(b).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function v(b){var f=1!=b.indexOf("?")?"?":"&";return b+f+"_cachebust="+Date.now()}try{document.domain="compare.js"}catch(x){r("FAILed to set document.domain to compare.js - make sure that you've your ServerName is correctly set to compare.js")}r={init:function(){this.responseActive=!1;this.frameA=this.make_iframe();this.frameB=this.make_iframe();this.parse_dom();this.settings=
{};this.events()},parse_dom:function(){this.wrapper=document.getElementById("wrapper");this.inA=document.getElementById("page-a");this.inB=document.getElementById("page-b");this.startOverBtn=document.getElementById("do-start-over");this.inBtn=document.getElementById("do-compare");this.loading=document.getElementById("loading");this.settingsDom={toggle:document.getElementById("settings-toggle"),cacheBust:document.getElementById("settings-cache-bust"),mode:document.getElementById("settings-mode")};
this.response=document.getElementById("response");this.responseIcon=document.getElementById("response-icon");this.responseSummary=document.getElementById("response-summary");this.responseDetails=document.getElementById("response-details")},process_settings:function(){this.settings.cacheBust="yes"===this.settingsDom.cacheBust.value;this.settings.mode=this.settingsDom.mode.value},process_start_over:function(){this.process_comparison(!0)},process_comparison:function(b){var f;""!==this.inA.value&&""!==
this.inB.value&&(this.process_settings(),this.toggle_settings(!1),this.inBtn.className="",this.loading.setAttribute("class","visible"),this.remove_response(),!0===b||"single"===this.settings.mode?(b=this.get_contents(this.frameA,this.inA.value),f=this.get_contents(this.frameB,this.inB.value),g.all([b,f]).then(this.do_compare.bind(this),this.compare_failed.bind(this))):this.do_compare([this.frameA.contentDocument.body,this.frameB.contentDocument.body]))},response_active:function(){this.responseActive=
!0;this.wrapper.setAttribute("class","with-response")},response_inactive:function(){this.responseActive=!1;this.wrapper.removeAttribute("class")},loading_finished:function(){this.loading.removeAttribute("class")},do_compare:function(b){var f;this.compare=new k({a:b[0],b:b[1]});b=this.compare.differences;this.loading_finished();this.response_active();for(f in b)if(0!==b[f].length){this.differences_true(b);return}this.differences_false()},remove_response:function(){this.response.removeAttribute("class");
this.responseIcon.removeAttribute("class");this.responseSummary.innerHTML="";this.responseDetails.innerHTML=""},differences_true:function(b){var f=0,g=document.createElement("ul"),l,p,n,k,r;for(l in b)for(p=b[l],k=p.length,f+=p.length,r=0;r<k;r++)n=document.createElement("li"),n.innerHTML=this.report_difference(l,p[r]),g.appendChild(n);this.compare.stopped_at_max&&(f+="+");this.response.setAttribute("class","errors");this.responseIcon.setAttribute("class","issues fa fa-exclamation-circle");this.responseSummary.innerHTML=
f+" Difference(s) Found";this.responseDetails.appendChild(g)},differences_false:function(){this.response.setAttribute("class","identical");this.responseIcon.setAttribute("class","fa fa-check-circle");this.responseSummary.innerHTML="Pages are identical";this.responseDetails.innerHTML="We've checked the pages for both DOM and visual differences, and we couldn't find any!"},report_difference:function(b,f){switch(b){case "retag":return'Tag change<code class="a">'+l(f[0]._originalSig)+'</code><code class="b">'+
l(f[1]._originalSig)+"</code>";case "reattribute":return'Attribute change<code class="a">'+l(f[0]._originalSig)+'</code><code class="b">'+l(f[1]._originalSig)+"</code>";case "removed":return'Element removed<code class="a removed">'+l(f[0]._originalSig)+"</code>";case "added":return'Element added<code class="b">'+l(f[0]._originalSig)+"</code>";case "text":return'Text changed<code class="a">'+l(f[0]._originalSig)+'</code><code class="b">'+l(f[1]._originalSig)+"</code>";case "moved":return'Element Moved<code class="a">'+
l(f[0]._originalSig)+"</code>";case "style":var g=f[0]._styleDiff,k=f[0]._styleAffects,p="",n="",r=Object.keys(g.a).length,s=Object.keys(g.b).length,u;for(u in g.a)1<r&&(p+="\n  "),p+=u+": "+g.a[u]+"; ";for(u in g.b)1<s&&(n+="\n  "),n+=u+": "+g.b[u]+"; ";1<r&&(p+="\n");1<s&&(n+="\n");return"Style change affecting "+k+' element(s)<code class="c">'+l(f[0]._originalSig)+'</code><code class="a">{ '+p+'}</code><code class="b">{ '+n+"}</code>"}},compare_failed:function(b){this.loading_finished();this.remove_response();
this.response_active();this.response.setAttribute("class","errors");this.responseIcon.setAttribute("class","issues fa fa-exclamation-circle");this.responseSummary.innerHTML="Comparison failed";this.responseDetails.innerHTML="SecurityError"===b.error.name?"Failed to access <em>"+b.url+"</em> due to cross-origin restrictions":"An unknown error was raised whilst trying to load "+b.url},make_iframe:function(){var b=document.createElement("iframe");document.getElementById("iframes").appendChild(b);return b},
get_contents:function(b,f){b.src=this.settings.cacheBust?v(f):f;b.removeEventListener("load",b._loadEvent);return new g(function(g,k){b._loadEvent=function(){try{g(b.contentDocument.body)}catch(l){k({error:l,url:f})}};b.addEventListener("load",b._loadEvent)})},process_if_enter:function(b){13==b.keyCode&&this.process_comparison()},toggle_settings:function(b){this.settingsDom.toggle.className=!0===b||!1!==b&&""===this.settingsDom.toggle.className?this.settingsDom.toggle.className+"open":""},toggle_mode:function(){document.body.className=
"mode-"+this.settingsDom.mode.value;if(""===this.frameA.src||""===this.frameB.src)this.inBtn.className="disabled"},events:function(){this.inBtn.addEventListener("click",this.process_comparison.bind(this));this.startOverBtn.addEventListener("click",this.process_start_over.bind(this));this.inA.addEventListener("keypress",this.process_if_enter.bind(this));this.inB.addEventListener("keypress",this.process_if_enter.bind(this));this.settingsDom.toggle.addEventListener("click",this.toggle_settings.bind(this));
this.settingsDom.mode.addEventListener("click",this.toggle_mode.bind(this))}};document.addEventListener("DOMContentLoaded",r.init.bind(r))})(window.Promise,window.Compare,window.console.log.bind(window.console));
